---
import "../styles/global.css";

const { title } = Astro.props;

// Safe currentLang extraction
const currentUrl = Astro.url?.pathname || '';
const pathParts = currentUrl.split('/').filter(Boolean);
const currentLang = ['en','hi','mr'].includes(pathParts[0]) ? pathParts[0] : 'en';
const currentPage = pathParts.slice(1).join('/') || '';

const langs = ['en', 'hi', 'mr'];
const langNames = { en: 'EN', hi: 'हिंदी', mr: 'मराठी' };

const menuLabels = {
  en: { home: 'Home', about: 'About Doctors', treatments: 'Treatments', whyhomeopathy: 'Why Homeopathy', testimonials: 'Testimonials', contact:'Contact' },
  hi: { home: 'होम', about: 'डॉक्टरों के बारे में', treatments: 'उपचार', whyhomeopathy: 'होम्योपैथी क्यों', testimonials: 'प्रशंसापत्र', contact:'संपर्क' },
  mr: { home: 'मुख्यपृष्ठ', about: 'डॉक्टरांविषयी', treatments: 'उपचार', whyhomeopathy: 'होमिओपॅथी का', testimonials: 'प्रशंसापत्रे', contact:'संपर्क' },
};

const clinicNames = {
  en: ["Piyush","Homeopathic","Clinic"],
  hi: ["पियूष","होम्योपैथिक","क्लिनिक"],
  mr: ["पीयुष","होमिओपॅथिक","क्लिनिक"]  
};

// Icon mapping for menus
const menuIcons = {
  home: 'fas fa-home',
  about: 'fas fa-user-md',
  treatments: 'fas fa-stethoscope',
  whyhomeopathy: 'fas fa-leaf',
  testimonials: 'fas fa-comment-dots',
  contact: 'fas fa-envelope'
};

// Helper functions for safe access
const getClinicName = (lang = 'en') => clinicNames[lang] ?? clinicNames['en'];
const getMenuLabel = (lang = 'en') => menuLabels[lang] ?? menuLabels['en'];
---
<!DOCTYPE html>
<html lang={currentLang}>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{title}</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="bg-green-100 text-green-700 p-4 shadow-md w-full relative">

    <!-- Mobile Header -->
    <div class="md:hidden max-w-7xl mx-auto px-2 py-4 flex items-start justify-between">
      <div class="flex gap-4">
        <img src="/images/download.png" alt="Logo" class="h-24 w-24 sm:h-32 sm:w-32 object-contain"/>
        <div class="flex flex-col leading-tight text-left">
          <span class="text-xs text-gray-700 font-bold">since 1980</span>
          <div class="flex flex-col">
            <span class="text-3xl sm:text-4xl font-extrabold">{getClinicName(currentLang)[0]}</span>
            <span class="text-2xl sm:text-3xl font-bold">{getClinicName(currentLang).slice(1).join(' ')}</span>
          </div>
        </div>
      </div>

      <div class="flex items-center sm:hidden">
        <button id="hamburger" class="flex flex-col items-center justify-center p-3 rounded-lg border border-gray-300 transition-all duration-300 ease-in-out hover:bg-gray-100 hover:scale-105 active:scale-95 focus:outline-none" aria-label="Open Menu">
          <span class="text-2xl leading-none">☰</span>
          <span id="menuText" class="text-xs mt-1 text-gray-600">See Menu</span>
        </button>
      </div>
    </div>

    <!-- Mobile Language Switcher -->
    <div class="flex justify-end gap-2 text-sm px-2 mt-2 md:hidden">
      {langs.map((lang, i) => (
        <span key={lang}>
          <a href={`/${lang}/${currentPage}`.replace(/\/$/, '')} class="hover:text-yellow-300">{langNames[lang]}</a>
          {i < langs.length - 1 ? '|' : ''}
        </span>
      ))}
    </div>

    <!-- Desktop Header -->
    <div class="hidden md:flex max-w-7xl mx-auto px-4 py-4 items-center justify-between">
      <div class="flex items-center gap-4">
        <img src="/images/download.png" alt="Logo" class="h-40 w-40 object-contain flex-shrink-0" />
        <div class="flex flex-col leading-tight">
          <span class="text-sm text-gray-700 w-full text-right pr-4 font-bold">since 1980</span>
          <div class="flex items-baseline gap-2">
            <span class="text-4xl font-extrabold">{getClinicName(currentLang)[0]}</span>
            <span class="text-2xl font-bold">{getClinicName(currentLang).slice(1).join(' ')}</span>
          </div>
        </div>
      </div>
      <div class="flex gap-2 text-sm">
        {langs.map((lang, i) => (
          <span key={lang}>
            <a href={`/${lang}/${currentPage}`.replace(/\/$/, '')} class="hover:text-yellow-300">{langNames[lang]}</a>
            {i < langs.length - 1 ? '|' : ''}
          </span>
        ))}
      </div>
    </div>

    <!-- Desktop Menu -->
    <nav class="hidden md:flex max-w-7xl mx-auto px-4 py-2 justify-start gap-8 font-semibold overflow-x-auto">
      {Object.entries(getMenuLabel(currentLang)).map(([key, label]) => (
        <a href={`/${currentLang}/${key === 'home' ? '' : key}`} class="hover:text-yellow-300 whitespace-nowrap flex items-center gap-1">
          <i class={menuIcons[key]}></i>
          {label}
        </a>
      ))}
    </nav>

    <!-- Mobile Menu -->
    <nav id="main-nav" class="hidden md:hidden flex-col gap-2 px-6 py-4 bg-yellow-100 text-black absolute top-full left-0 w-full z-40">
      {Object.entries(getMenuLabel(currentLang)).map(([key, label]) => (
        <a href={`/${currentLang}/${key === 'home' ? '' : key}`} class="flex items-center gap-2 py-2 hover:text-yellow-300 font-semibold">
          <i class={menuIcons[key]}></i>
          {label}
        </a>
      ))}
    </nav>

  </header>

  <main class="flex-1 w-full px-6 py-8"><slot /></main>

  <!-- FOOTER -->
  <footer class="bg-black text-white">
    <div class="max-w-7xl mx-auto px-6 py-6 flex flex-col md:flex-row items-center justify-between gap-4 md:gap-0">
      <div class="text-center md:text-left">
        <h4 class="text-lg font-bold hover:text-yellow-400 transition duration-300">{getClinicName(currentLang).join(' ')}</h4>
        <p class="text-sm text-white/80 mt-1">Natural & safe homeopathic treatment.</p>
      </div>
      <div class="flex flex-wrap justify-center md:justify-start gap-6">
        {['home','contact','treatments','whyhomeopathy'].map(key => (
          <a href={`/${currentLang}/${key === 'home' ? '' : key}`} class="text-white text-sm hover:text-yellow-400">{getMenuLabel(currentLang)[key]}</a>
        ))}
      </div>
      <div class="flex gap-4">
        <a href="#" class="text-white hover:text-yellow-400 text-xl"><i class="fab fa-facebook-f"></i></a>
        <a href="#" class="text-white hover:text-yellow-400 text-xl"><i class="fab fa-instagram"></i></a>
        <a href="#" class="text-white hover:text-yellow-400 text-xl"><i class="fab fa-linkedin-in"></i></a>
        <a href="#" class="text-white hover:text-yellow-400 text-xl"><i class="fab fa-twitter"></i></a>
      </div>
    </div>

    <div class="border-t border-white/30 text-center text-sm text-white/70 py-2 mt-2">
      © <span id="year"></span> {getClinicName(currentLang).join(' ')} — All rights reserved.
    </div>

    <script>
      document.getElementById('year').textContent = new Date().getFullYear();
    </script>

  </footer>

  <!-- Hamburger Toggle -->
  <script type="module">
    document.addEventListener('DOMContentLoaded', () => {
      const hamburger = document.getElementById('hamburger');
      const mainNav = document.getElementById('main-nav');
      hamburger.addEventListener('click', () => mainNav.classList.toggle('hidden'));
    });
  </script>

</body>
</html>
